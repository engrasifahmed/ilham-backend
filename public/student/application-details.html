<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Details - ILHAM Student Portal</title>
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="../css/main.css">
    <style>
        .glass-modal {
            max-width: 800px;
            margin: 40px auto;
            background: rgba(255, 255, 255, 0.05);
            /* Very transparent */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            color: white;
        }

        .glass-modal h2,
        .glass-modal h3,
        .glass-modal div,
        .glass-modal span,
        .glass-modal p {
            color: white !important;
        }

        .glass-modal .text-muted {
            color: rgba(255, 255, 255, 0.6) !important;
        }

        /* Override timeline colors if needed */
        .timeline-item div {
            color: white;
        }
    </style>
</head>

<body>
    <div id="navbar-placeholder"></div>
    <!-- Note: layout.js injects navbar? No, static in HTML. I should copy struct -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">
                <img src="/Logo.png" alt="ILHAM" style="height: 40px;">
            </div>
        </div>
        <div class="nav-right">
            <div class="profile-section" id="profile-section">
                <div class="profile-avatar" id="profile-avatar">S</div>
                <span id="student-name">Student</span>
            </div>
        </div>
    </nav>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="sidebar-section-title">Main</div>
            <ul class="sidebar-menu">
                <li class="sidebar-item"><a href="dashboard.html" class="sidebar-link"><span>Dashboard</span></a></li>
            </ul>
        </div>
        <div class="sidebar-section">
            <div class="sidebar-section-title">Applications</div>
            <ul class="sidebar-menu">
                <li class="sidebar-item"><a href="applications.html" class="sidebar-link active"><span>My
                            Applications</span></a></li>
            </ul>
        </div>
    </aside>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Application Status</h1>
            <p class="page-subtitle">Track the progress of your application</p>
        </div>

        <div id="app-details-container" class="glass-modal">
            <div style="text-align:center; padding: 40px;">
                <div class="spinner"></div>
                <p>Loading details...</p>
            </div>
        </div>
    </main>

    <script src="layout.js"></script>
    <script>
        async function loadDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            if (!id) {
                window.location.href = 'applications.html';
                return;
            }

            try {
                const auth = checkAuth();
                // Fetch All Apps (or single if endpoint exists)
                // Fetch All Apps (or single if endpoint exists)
                // Existing API: /api/applications/my returns All. 
                // We filter clientside for now as 'my' is small.
                const res = await fetch('/api/applications/my', {
                    headers: { 'Authorization': `Bearer ${auth.token}` }
                });

                if (res.ok) {
                    const apps = await res.json();
                    const app = apps.find(a => a.id == id);
                    if (app) {
                        displayDetails(app);
                    } else {
                        showError("Application not found.");
                    }
                } else {
                    showError("Failed to fetch data.");
                }
            } catch (e) {
                showError(e.message);
            }
        }

        function displayDetails(app) {
            const container = document.getElementById('app-details-container');
            const statusColor = getStatusBadge(app.status);

            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 24px;">
                    <div>
                        <h2 style="font-size: 24px; margin-bottom: 8px;">${app.university_name}</h2>
                        <div class="text-muted" style="font-size: 16px;">${app.program_name || 'Program N/A'}</div>
                        <div style="margin-top: 8px;">
                            <span class="badge ${statusColor}" style="font-size: 14px; padding: 6px 16px;">${app.status}</span>
                        </div>
                    </div>
                    <div class="text-muted" style="text-align: right;">
                        <div>Applied on</div>
                        <div>${formatDate(app.created_at)}</div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                    <h3 style="margin-bottom: 16px; font-size: 18px;">Timeline</h3>
                    
                    <div class="timeline-item" style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);"></div>
                        <div>
                            <div style="font-weight: 600;">Application Submitted</div>
                            <div style="font-size: 12px; color: var(--text-muted);">${formatDate(app.created_at)}</div>
                        </div>
                    </div>

                    ${app.status === 'Rejected' ? `
                    <div class="timeline-item" style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--danger);"></div>
                        <div>
                             <div style="font-weight: 600; color: var(--danger);">Application Rejected</div>
                             <div style="font-size: 12px; color: var(--text-muted);">Please contact support or apply to another university.</div>
                        </div>
                    </div>
                    ` : ''}

                     ${app.status === 'Approved' ? `
                    <div class="timeline-item" style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--success);"></div>
                        <div>
                             <div style="font-weight: 600; color: var(--success);">Congratulations! Application Approved.</div>
                             <div style="font-size: 12px; color: var(--text-muted);">Check your email for the offer letter.</div>
                        </div>
                    </div>
                    ` : ''}
                </div>

                ${app.status === 'Rejected' ? `
                    <div style="text-align: right;">
                         <button class="btn btn-primary" onclick="window.location.href='application-new.html'">Refiled / New Application</button>
                    </div>
                ` : ''}
            `;
        }

        function showError(msg) {
            document.getElementById('app-details-container').innerHTML = `<p style="color:red; text-align:center;">${msg}</p>`;
        }

        loadDetails();
    </script>
</body>

</html>